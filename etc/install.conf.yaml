#======  DOTBOT  ============================================================
#          NAME:  install.conf.yaml
#   DESCRIPTION:  Install config for dotbot
#==============================================================================
---
- clean: ['~']

- shell:
  - [git pull, Updating repository]
  - [git submodule update --init --recursive, Installing submodules]
  - [mkdir -p ~/.log/archive, Making log directories]
  - [mkdir -p ~/.ssh/, Making SSH directory]
  - [mkdir -p ~/.gnupg/, Making GPG directory]
  - [mkdir -p ~/.etc, Making etc directory]
  - [mkdir -p ~/.m2, Making maven directory]
  - [mkdir -p ~/.config, Making configuration directory]
  - [chmod 700 ~/.ssh, Changing permissions on .ssh directory]

- link:
  ~/.dotfiles: ''
  ~/.alias: alias
  ~/.bashrc: bashrc
  ~/.bash_profile: bash_profile
  ~/.curlrc: etc/curlrc
  ~/.wgetrc: etc/wgetrc
  ~/.digrc: etc/digrc
  ~/.kshrc: kshrc
  ~/.ldaprc: etc/ldaprc
  ~/.profile: profile
  ~/.screenrc: etc/screenrc
  ~/.vimrc: etc/vimrc
  ~/.functions: functions
  ~/.alias.d: alias.d/
  ~/.bin: bin/
  ~/.functions.d: functions.d/
  ~/.lib: lib/
  ~/.profile.d: profile.d/
  ~/.config/git: config/git
  ~/.config/systemd: config/systemd
  ~/.config/tmux: config/tmux
  ~/.etc/SecurityService: etc/SecurityService
  ~/.etc/eSolutionsCore: etc/eSolutionsCore
  ~/.etc/resources: etc/resources
  ~/.etc/mail.properties: etc/mail.properties
  ~/.etc/logging.properties: etc/logging.properties
  ~/.etc/excludes: etc/excludes
  ~/.gnupg/gpg.conf: gnupg/gpg.conf
  ~/.gnupg/gpg-agent.conf: gnupg/gpg-agent.conf
  ~/.m2/settings.xml: m2/settings.xml
  ~/.ssh/config: ssh/config
  ~/.ssh/config.d: ssh/config.d

- shell:
  - [cd ~/.dotbot && find . -type d -exec chmod 755, Ensuring file permissions are 755 on all directories]
  - [cd ~/.dotbot && find . -type f -exec chmod 644, Ensuring file permissions are 644 on all files]
  - [chmod 600 ~/.dotbot/etc/ldaprc, Ensuring file permissions are 600 on etc/ldaprc]
  - [chmod 600 ~/.dotbot/etc/curlrc, Ensuring file permissions are 600 on etc/curlrc]
  - [chmod 600 ~/.dotbot/etc/SecurityService/config/ServiceConfig.xml, Ensuring file permissions are 600 on ~/.etc/SecurityService/config/ServiceConfig.xml]
  - [chmod 600 ~/.dotbot/etc/eSolutionsCore/config/ServiceConfig.xml, Ensuring file permissions are 600 on ~/.etc/eSolutionsCore/config/ServiceConfig.xml]
  - [chmod 755 ~/.dotbot/bin/*, Ensuring file permissions are 755 on ~/.bin/*]
  - [chmod 755 ~/.dotbot/lib/*, Ensuring file permissions are 755 on ~/.lib/*]
  - [cd ~/.ssh && [ -f id_rsa ] || ssh-keygen -t rsa -b 4096 -N "" -C "" -f ~/.ssh/id_rsa, Creating SSH keypair]
